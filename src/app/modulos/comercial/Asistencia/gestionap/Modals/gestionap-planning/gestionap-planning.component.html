<!-- #region Spinner -->
<ngx-spinner
  name="gestionap_planning_modal"
  [fullScreen]="false"
  type="ball-clip-rotate-multiple"
  size="medium"
>
  <p style="color: white; padding-top: 50px">Cargando información...</p>
</ngx-spinner>
<!-- #endregion -->

<!-- #region FB -->
<div class="fab-container">
  <button mat-mini-fab class="fab-toggler" (click)="accionGroupFb()">
    <i class="material-icons" [@fabToggler]="{ value: animacionFb }">add</i>
  </button>
  <div [@speedDialStagger]="opcionesFb.length">
    <button
      *ngFor="let btn of opcionesFb; let ibtn = index"
      mat-mini-fab
      class="fab-secondary"
      color="secondary"
      (click)="accionesOpcionesFb(ibtn)"
      [disabled]="btn.disabled"
    >
      <i
        class="material-icons"
        matTooltip="{{ btn.tool }}"
        matTooltipPosition="left"
        >{{ btn.icon }}</i
      >
    </button>
  </div>
</div>
<!-- #endregion -->

<!-- #region HEADER-->
<div class="modal-header">
  <h4 class="modal-title" id="modal-basic-title">Información del planning</h4>
  <button
    type="button"
    class="close"
    aria-label="Close"
    (click)="cerrarModal()"
  >
    <span class="material-icons">close</span>
  </button>
</div>
<!-- #endregion -->

<div class="modal-body">
  <div class="row" style="margin-bottom: 15px">
    <div id="dLeftDetail" class="col-lg-6">
      <mat-accordion multi>
        <mat-expansion-panel [expanded]="true" [disabled]="true">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <span>Informacion personal : </span>
            </mat-panel-title>
            <mat-panel-description style="margin-right: 0px">
            </mat-panel-description>
            <mat-icon style="margin-right: 10px">account_circle</mat-icon>
          </mat-expansion-panel-header>

          <div>
            <div class="row">
              <div class="col-lg-12 divAvatar">
                <img
                  class="imgAvatar"
                  src="../../../../../assets/img/LuckyAvatar.png"
                  alt=""
                />
              </div>
            </div>

            <div class="row">
              <div
                id="formDisabled"
                [formGroup]="infoPersonal"
                class="col-lg-12"
              >
                <div class="form-row">
                  <div class="col-lg-12">
                    <mat-form-field style="width: 100%">
                      <mat-label>Apellidos y nombres</mat-label>
                      <input type="text" matInput formControlName="nombres" />
                    </mat-form-field>
                  </div>
                </div>

                <div class="form-row">
                  <div class="col-lg-7">
                    <mat-form-field style="width: 100%">
                      <mat-label>Tipo documento</mat-label>
                      <input
                        type="text"
                        matInput
                        formControlName="tipoDocumento"
                      />
                    </mat-form-field>
                  </div>

                  <div class="col-lg-5">
                    <mat-form-field style="width: 100%">
                      <mat-label>N° Documento</mat-label>
                      <input
                        type="text"
                        matInput
                        formControlName="nroDocumento"
                      />
                    </mat-form-field>
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-sm">
                <h6>Datos de Asistencia :</h6>
                <hr style="margin-top: 0px; margin-bottom: 10px" />
              </div>
            </div>

            <div class="row">
              <div
                id="formDisabled"
                [formGroup]="datosAsistencia"
                class="col-lg-12"
              >
                <div class="form-row">
                  <div class="col-lg-4">
                    <mat-form-field style="width: 100%">
                      <mat-label>Fecha</mat-label>
                      <input
                        formControlName="fecha"
                        matInput
                        [matDatepicker]="dFecha"
                      />
                      <mat-datepicker-toggle
                        matSuffix
                        [for]="dFecha"
                      ></mat-datepicker-toggle>
                      <mat-datepicker #dFecha></mat-datepicker>
                    </mat-form-field>
                  </div>

                  <div class="col-lg-4">
                    <mat-form-field style="width: 100%">
                      <mat-label>Hora de entrada</mat-label>
                      <input
                        type="text"
                        matInput
                        formControlName="horaEntrada"
                      />
                      <mat-datepicker-toggle
                        matSuffix
                        [for]="sHoraIni"
                        disabled
                      >
                        <mat-icon matDatepickerToggleIcon>schedule</mat-icon>
                      </mat-datepicker-toggle>
                      <mat-datepicker #sHoraIni></mat-datepicker>
                    </mat-form-field>
                  </div>

                  <div class="col-lg-4">
                    <mat-form-field style="width: 100%">
                      <mat-label>Hora de salida</mat-label>
                      <input
                        type="text"
                        matInput
                        formControlName="horaSalida"
                      />
                      <mat-datepicker-toggle
                        matSuffix
                        [for]="sHoraFin"
                        disabled
                      >
                        <mat-icon matDatepickerToggleIcon>schedule</mat-icon>
                      </mat-datepicker-toggle>
                      <mat-datepicker #sHoraFin></mat-datepicker>
                    </mat-form-field>
                  </div>
                </div>

                <div class="form-row">
                  <div class="col-lg-12">
                    <mat-form-field style="width: 100%">
                      <mat-label>Responsable</mat-label>
                      <input
                        type="text"
                        matInput
                        formControlName="responsable"
                      />
                    </mat-form-field>
                  </div>
                </div>

                <div class="form-row">
                  <div class="col-lg-12">
                    <mat-form-field style="width: 100%">
                      <mat-label>Cliente / Área</mat-label>
                      <input
                        type="text"
                        matInput
                        formControlName="clienteArea"
                      />
                    </mat-form-field>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </mat-expansion-panel>
      </mat-accordion>
    </div>

    <mat-divider [vertical]="true"></mat-divider>

    <div id="dRigthDetail" class="col-lg" style="margin-right: 15px">
      <div class="row">
        <div class="col-sm">
          <h6>Puntos de asistencia : ({{ cantidadRegistros() }})</h6>
          <hr style="margin-top: 0px; margin-bottom: 10px" />
        </div>
      </div>

      <div
        style="
          height: 473px;
          padding-right: 15px;
          overflow-y: auto;
          padding-left: 2px;
        "
      >
        <table
          #tablaPuntosAP
          mat-table
          [dataSource]="puntosaDS"
          style="width: 100%"
          multiTemplateDataRows
        >
          <!-- Action Column -->
          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef>Visualizar</th>
            <td mat-cell *matCellDef="let element">
              <!-- #region Fab opciones-->
              <div class="fab-resp">
                <button
                  mat-mini-fab
                  class="fab-toggler-resp"
                  (click)="puntoAsistenciaGroupFb(element)"
                  [disabled]="element.nIdEstado === 2390"
                >
                  <i class="material-icons">{{
                    puntoAsistenciaIconGroupFb(element)
                  }}</i>
                </button>

                <div
                  *ngIf="
                    element.nIdRuta === puntoAsistenciaSeleccionado.nIdRuta
                  "
                  [@speedDialStagger]="puntoAsistenciaFb.length"
                  class="list-fab"
                >
                  <button
                    *ngFor="let btn of puntoAsistenciaFb; let ibtn = index"
                    mat-mini-fab
                    class="fab-secondary-resp"
                    color="secondary"
                    (click)="accionPuntoAsistenciaFb(ibtn, element)"
                    [disabled]="btn.disabled"
                  >
                    <i
                      class="material-icons"
                      matTooltip="{{ btn.tool }}"
                      matTooltipPosition="below"
                      >{{ btn.icon }}</i
                    >
                  </button>
                </div>
              </div>
              <!-- #endregion -->
            </td>
          </ng-container>

          <ng-container matColumnDef="sDireccion">
            <th mat-header-cell *matHeaderCellDef>Dirección</th>
            <td
              mat-cell
              *matCellDef="let element"
              class="has_label_on_mobile"
              data-label=""
            >
              {{ capitalizeFirstLetter(element.sDireccion) }}
            </td>
          </ng-container>

          <ng-container matColumnDef="sDepartamento">
            <th mat-header-cell *matHeaderCellDef>Departamento</th>
            <td
              mat-cell
              *matCellDef="let element"
              class="m-card-sub-title"
              data-label="Departamento :"
            >
              {{ element.sDepartamento }}
            </td>
          </ng-container>

          <ng-container matColumnDef="sProvincia">
            <th mat-header-cell *matHeaderCellDef>Provincia</th>
            <td
              mat-cell
              *matCellDef="let element"
              class="m-card-sub-title"
              data-label="Provincia :"
            >
              {{ element.sProvincia }}
            </td>
          </ng-container>

          <ng-container matColumnDef="sDistrito">
            <th mat-header-cell *matHeaderCellDef>Distrito</th>
            <td
              mat-cell
              *matCellDef="let element"
              class="m-card-sub-title"
              data-label="Distrito :"
            >
              {{ element.sDistrito }}
            </td>
          </ng-container>

          <ng-container matColumnDef="gestion">
            <th mat-header-cell *matHeaderCellDef>Gestion</th>
            <td
              mat-cell
              *matCellDef="let element"
              class="m-card-sub-title"
              data-label="Gestion :"
            >
              Gestion: {{ element.sGestion }}
            </td>
          </ng-container>

          <ng-container matColumnDef="justificacion">
            <th mat-header-cell *matHeaderCellDef>Justificacion</th>
            <td
              mat-cell
              *matCellDef="let element"
              class="m-card-sub-title"
              data-label="Justificacion :"
            >
              Justificacion: {{ element.sJustificacion }}
            </td>
          </ng-container>

          <!-- More Column -->
          <ng-container matColumnDef="more">
            <th mat-header-cell *matHeaderCellDef></th>
            <td
              mat-cell
              *matCellDef="let element; let row"
              (click)="clickExpanded(row)"
              [ngClass]="{ ocultarExpanded: element.sTexto === '' }"
            >
              <span
                [@fabToggler]="element == expandedMore ? 'active3' : 'inactive'"
                class="material-icons"
                style="cursor: pointer"
                >expand_more</span
              >
            </td>
          </ng-container>

          <!-- More Expanded -->
          <ng-container matColumnDef="expanded_More">
            <td
              mat-cell
              *matCellDef="let element"
              [attr.colspan]="puntosaDC.length"
            >
              <div
                style="
                  overflow: hidden;
                  border: 1px solid #f5ecec;
                  padding: 0px 10px;
                "
                [@detailExpand]="
                  element == expandedMore ? 'expanded' : 'collapsed'
                "
              >
                <div class="row" style="padding: 10px 10px 0px 10px">
                  <div
                    class="col-lg-12"
                    style="padding-left: 5px; padding-right: 0px"
                  >
                    <div class="col-sm" style="padding: 0px 0px 0px 0px">
                      <h6>Observacion:</h6>
                      <hr style="margin-top: 0px; margin-bottom: 10px" />
                    </div>

                    <div>
                      <mat-form-field style="width: 100%">
                        <textarea
                          [(ngModel)]="element.sTexto"
                          [disabled]="true"
                          matInput
                        ></textarea>
                      </mat-form-field>
                    </div>
                    <div
                      *ngIf="element.nIdEstado === 2329"
                      class="alert alert-warning"
                      role="alert"
                    >
                      Desestimacion en espera
                    </div>
                    <div
                      *ngIf="element.nIdEstado === 2330"
                      class="alert alert-success"
                      role="alert"
                    >
                      Desestimacion confirmada
                    </div>
                    <div
                      *ngIf="element.nIdEstado === 2331"
                      class="alert alert-danger"
                      role="alert"
                    >
                      Desestimacion invalidada
                    </div>
                  </div>
                </div>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="noData">
            <mat-footer-cell
              *matFooterCellDef
              [attr.colspan]="puntosaDC.length"
            >
              No se encuentran registros.
            </mat-footer-cell>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="puntosaDC"></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: puntosaDC"
            [ngClass]="{
              border_top_row_table_inactive:
                row.nIdRuta !== puntoAsistenciaSeleccionado.nIdRuta,
              border_top_row_table_active:
                row.nIdRuta === puntoAsistenciaSeleccionado.nIdRuta
            }"
          ></tr>

          <tr
            mat-row
            *matRowDef="let row; columns: ['expanded_More']"
            [class.example-expanded-row]="expandedMore === row"
            style="height: 0px; border-top-style: none"
          ></tr>

          <mat-footer-row
            *matFooterRowDef="['noData']"
            [hidden]="puntosaDS && this.puntosaDS.filteredData.length > 0"
          ></mat-footer-row>
        </table>
      </div>
    </div>
  </div>
</div>

<mat-progress-bar
  *ngIf="false"
  color="accent"
  mode="indeterminate"
></mat-progress-bar>
